# Generated by Claude.
openapi: 3.1.0
info:
  title: Alexandria API
  description: API for managing libraries and books
  version: 1.0.0
  contact:
    name: Alexandria

servers:
  - url: /v1
    description: API v1

security:
  - bearerAuth: []

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: AWS Cognito JWT token

  schemas:
    Error:
      type: object
      properties:
        message:
          type: string
      required:
        - message

    # Detection
    DetectRequest:
      type: object
      properties:
        type:
          type: integer
          description: "Item type (0 = Book)"
          enum: [0]
        code:
          type: string
          description: "ISBN code (10 or 13 digits)"
      required:
        - type
        - code

    DetectedBookResponse:
      type: object
      properties:
        id:
          type: string
        authors:
          type: array
          items:
            type: string
        title:
          type: string
        summary:
          type: string
        pictureUrl:
          type: string
          nullable: true
        isbn:
          type: string
        source:
          type: string
        error:
          type: string
          nullable: true

    DetectResponse:
      type: object
      properties:
        detectedBooks:
          type: array
          items:
            $ref: "#/components/schemas/DetectedBookResponse"

    # Library
    CreateLibraryRequest:
      type: object
      properties:
        name:
          type: string
          maxLength: 20
          description: "Library name (required, max 20 chars)"
        description:
          type: string
          maxLength: 100
          description: "Library description (max 100 chars)"
      required:
        - name

    CreateLibraryResponse:
      type: object
      properties:
        id:
          type: string
        totalItems:
          type: integer
        updatedAt:
          type: string
          format: date-time
          nullable: true

    UpdateLibraryRequest:
      type: object
      properties:
        name:
          type: string
          maxLength: 20
        description:
          type: string
          maxLength: 100
      required:
        - name

    GetLibraryResponse:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        description:
          type: string
        totalItems:
          type: integer
        updatedAt:
          type: string
          format: date-time
          nullable: true
        sharedTo:
          type: array
          items:
            type: string
          description: "List of usernames the library is shared with"
        sharedFrom:
          type: string
          nullable: true
          description: "Username of the owner if this is a shared library"

    GetLibrariesResponse:
      type: object
      properties:
        libraries:
          type: array
          items:
            $ref: "#/components/schemas/GetLibraryResponse"

    ShareRequest:
      type: object
      properties:
        userName:
          type: string
          format: email
          description: "Email of the user to share with"
      required:
        - userName

    UnshareRequest:
      type: object
      properties:
        userNames:
          type: array
          items:
            type: string
            format: email
          minItems: 1
          maxItems: 10
          description: "List of user emails to remove sharing from"
      required:
        - userNames

    # Items
    ItemType:
      type: integer
      enum: [0]
      description: "Item type (0 = Book)"

    GetItemResponseBase:
      type: object
      properties:
        id:
          type: string
        type:
          $ref: "#/components/schemas/ItemType"
        title:
          type: string
        picture:
          type: string
          nullable: true
          description: "Base64 encoded picture"
        pictureUrl:
          type: string
          nullable: true
        libraryId:
          type: string
          nullable: true
        libraryName:
          type: string
          nullable: true
        ownerId:
          type: string
        lentTo:
          type: string
          nullable: true
          description: "Name of person the item is lent to"
        collection:
          type: string
          nullable: true
          description: "Collection name (1-100 chars)"
        order:
          type: integer
          nullable: true
          description: "Order within collection (1-1000)"

    GetBookResponse:
      allOf:
        - $ref: "#/components/schemas/GetItemResponseBase"
        - type: object
          properties:
            authors:
              type: array
              items:
                type: string
            summary:
              type: string
            isbn:
              type: string

    GetLibrariesContentResponse:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: "#/components/schemas/GetBookResponse"
        nextToken:
          type: string
          description: "Pagination token for next page"

    CreateBookRequest:
      type: object
      properties:
        title:
          type: string
          maxLength: 100
        summary:
          type: string
          maxLength: 4000
        authors:
          type: array
          items:
            type: string
        isbn:
          type: string
        pictureUrl:
          type: string
          nullable: true
        collection:
          type: string
          nullable: true
          maxLength: 100
        order:
          type: integer
          nullable: true
          minimum: 1
          maximum: 1000
      required:
        - title

    CreateBookResponse:
      type: object
      properties:
        id:
          type: string
        updatedAt:
          type: string
          format: date-time
          nullable: true

    UpdateBookRequest:
      type: object
      properties:
        title:
          type: string
          maxLength: 100
        summary:
          type: string
          maxLength: 4000
        authors:
          type: array
          items:
            type: string
        isbn:
          type: string
        pictureUrl:
          type: string
          nullable: true
        collection:
          type: string
          nullable: true
          maxLength: 100
        order:
          type: integer
          nullable: true
          minimum: 1
          maximum: 1000
        updatePicture:
          type: boolean
          nullable: true
          description: "If true, fetch and update the picture from pictureUrl"
      required:
        - title

    # Item History
    ItemEventType:
      type: string
      enum:
        - LENT
        - RETURNED

    ItemHistoryEntryRequest:
      type: object
      properties:
        type:
          $ref: "#/components/schemas/ItemEventType"
        event:
          type: string
          maxLength: 50
          description: "Name of person (for lend/return)"
      required:
        - type
        - event

    ItemHistoryEntry:
      type: object
      properties:
        date:
          type: string
          format: date-time
          nullable: true
        type:
          $ref: "#/components/schemas/ItemEventType"
        event:
          type: string

    ItemHistoryEntryListResponse:
      type: object
      properties:
        events:
          type: array
          items:
            $ref: "#/components/schemas/ItemHistoryEntry"
        nextToken:
          type: string
          description: "Pagination token for next page"

    # Search
    SearchRequest:
      type: object
      properties:
        terms:
          type: array
          items:
            type: string
          description: "Search terms for fuzzy search"
      required:
        - terms

    SearchResponse:
      type: object
      properties:
        results:
          type: array
          items:
            $ref: "#/components/schemas/GetBookResponse"

paths:
  /detections:
    post:
      summary: Detect book by ISBN
      description: Resolve book information from ISBN code using external sources
      operationId: requestDetection
      tags:
        - Detection
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/DetectRequest"
      responses:
        "200":
          description: Successfully detected books
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/DetectResponse"
        "400":
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

  /libraries:
    get:
      summary: List libraries
      description: Get all libraries owned by or shared with the current user
      operationId: listLibraries
      tags:
        - Libraries
      responses:
        "200":
          description: List of libraries
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/GetLibrariesResponse"
        "500":
          description: Server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

    post:
      summary: Create library
      description: Create a new library
      operationId: createLibrary
      tags:
        - Libraries
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateLibraryRequest"
      responses:
        "201":
          description: Library created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CreateLibraryResponse"
        "400":
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "500":
          description: Server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

  /libraries/{libraryId}:
    parameters:
      - name: libraryId
        in: path
        required: true
        schema:
          type: string

    put:
      summary: Update library
      description: Update library name and description
      operationId: updateLibrary
      tags:
        - Libraries
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateLibraryRequest"
      responses:
        "200":
          description: Library updated
        "400":
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "500":
          description: Server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

    delete:
      summary: Delete library
      description: Delete a library and all its contents
      operationId: deleteLibrary
      tags:
        - Libraries
      responses:
        "200":
          description: Library deleted
        "500":
          description: Server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

  /libraries/{libraryId}/items:
    parameters:
      - name: libraryId
        in: path
        required: true
        schema:
          type: string

    get:
      summary: List library items
      description: Get paginated list of items in a library
      operationId: listLibraryItems
      tags:
        - Items
      parameters:
        - name: limit
          in: query
          schema:
            type: integer
            default: 10
            maximum: 20
          description: "Number of items per page (max 20)"
        - name: nextToken
          in: query
          schema:
            type: string
          description: "Pagination token from previous response"
      responses:
        "200":
          description: List of items
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/GetLibrariesContentResponse"
        "500":
          description: Server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

  /libraries/{libraryId}/books:
    parameters:
      - name: libraryId
        in: path
        required: true
        schema:
          type: string

    post:
      summary: Create book
      description: Add a new book to a library
      operationId: createBook
      tags:
        - Items
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateBookRequest"
      responses:
        "200":
          description: Book created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CreateBookResponse"
        "400":
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "500":
          description: Server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

  /libraries/{libraryId}/books/{bookId}:
    parameters:
      - name: libraryId
        in: path
        required: true
        schema:
          type: string
      - name: bookId
        in: path
        required: true
        schema:
          type: string

    put:
      summary: Update book
      description: Update book details
      operationId: updateBook
      tags:
        - Items
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateBookRequest"
      responses:
        "200":
          description: Book updated
        "400":
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "500":
          description: Server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

  /libraries/{libraryId}/items/{itemId}:
    parameters:
      - name: libraryId
        in: path
        required: true
        schema:
          type: string
      - name: itemId
        in: path
        required: true
        schema:
          type: string

    delete:
      summary: Delete item
      description: Delete an item from a library
      operationId: deleteItem
      tags:
        - Items
      responses:
        "200":
          description: Item deleted
        "500":
          description: Server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

  /libraries/{libraryId}/items/{itemId}/events:
    parameters:
      - name: libraryId
        in: path
        required: true
        schema:
          type: string
      - name: itemId
        in: path
        required: true
        schema:
          type: string

    get:
      summary: Get item history
      description: Get paginated lending/return history for an item
      operationId: getItemHistoryEvents
      tags:
        - Item History
      parameters:
        - name: limit
          in: query
          schema:
            type: integer
            default: 10
            maximum: 20
          description: "Number of events per page (max 20)"
        - name: nextToken
          in: query
          schema:
            type: string
          description: "Pagination token from previous response"
      responses:
        "200":
          description: Item history events
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ItemHistoryEntryListResponse"
        "500":
          description: Server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

    post:
      summary: Create history event
      description: Record a lend or return event for an item
      operationId: createItemHistoryEvent
      tags:
        - Item History
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ItemHistoryEntryRequest"
      responses:
        "201":
          description: Event created
        "400":
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

    delete:
      summary: Delete item history
      description: Delete all history events for an item
      operationId: deleteItemHistoryEvents
      tags:
        - Item History
      responses:
        "200":
          description: History deleted
        "500":
          description: Server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

  /libraries/{libraryId}/share:
    parameters:
      - name: libraryId
        in: path
        required: true
        schema:
          type: string

    post:
      summary: Share library
      description: Share a library with another user (read-only access)
      operationId: shareLibrary
      tags:
        - Sharing
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ShareRequest"
      responses:
        "200":
          description: Library shared
        "400":
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "500":
          description: Server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

  /libraries/{libraryId}/unshare:
    parameters:
      - name: libraryId
        in: path
        required: true
        schema:
          type: string

    post:
      summary: Unshare library
      description: Remove library sharing from one or more users
      operationId: unshareLibrary
      tags:
        - Sharing
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UnshareRequest"
      responses:
        "200":
          description: Library unshared
        "400":
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "500":
          description: Server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

  /search:
    post:
      summary: Search items
      description: Fuzzy search across all items in user's libraries
      operationId: search
      tags:
        - Search
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/SearchRequest"
      responses:
        "200":
          description: Search results
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SearchResponse"
        "400":
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "500":
          description: Server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

tags:
  - name: Detection
    description: ISBN detection and book lookup
  - name: Libraries
    description: Library management
  - name: Items
    description: Book and item management
  - name: Item History
    description: Lending and return tracking
  - name: Sharing
    description: Library sharing between users
  - name: Search
    description: Full-text search across items
